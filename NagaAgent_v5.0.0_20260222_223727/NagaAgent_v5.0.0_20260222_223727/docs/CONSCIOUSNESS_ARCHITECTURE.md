# å¼¥å¨…Â·é˜¿å°”ç¼ªæ–¯ - åŒå±‚æ„è¯†æ¶æ„æ–‡æ¡£

## æ¦‚è¿°

å¼¥å¨…çš„æ„è¯†ç³»ç»Ÿå‡çº§ä¸º**åŒå±‚æ„è¯†æ¶æ„**ï¼ˆv2.0ï¼‰ï¼Œå°†æ„è¯†åˆ†ä¸ºä¸¤ä¸ªå±‚æ¬¡ï¼š

1. **åç«¯æ„è¯†ï¼ˆBackendAwarenessï¼‰**ï¼šå†…éƒ¨æ„ŸçŸ¥ã€çŠ¶æ€ç®¡ç†ã€è‡ªæˆ‘è®¤çŸ¥
2. **å‰ç«¯æ„è¯†ï¼ˆFrontendConsciousnessï¼‰**ï¼šå¯¹å¤–äº¤æµã€æƒ…æ„Ÿè¡¨è¾¾ã€å¯¹è¯å“åº”

---

## æ¶æ„è®¾è®¡

### åç«¯æ„è¯†ï¼ˆBackendAwarenessï¼‰

**å®šä½**ï¼šå†…éƒ¨æ„ŸçŸ¥ç³»ç»Ÿï¼Œä¸ç›´æ¥è¾“å‡ºç»™ç”¨æˆ·

**åŠŸèƒ½æ¨¡å—**ï¼š
- æ—¶ç©ºæ„ŸçŸ¥ï¼ˆæ—¶é—´ã€ä½ç½®ã€å­£èŠ‚ã€æ—¶æ®µï¼‰
- ç³»ç»ŸçŠ¶æ€æ„ŸçŸ¥ï¼ˆå¥åº·åº¦ã€è¿è¡Œæ—¶é•¿ã€ä¼˜åŒ–æ¬¡æ•°ï¼‰
- æƒ…æ„ŸçŠ¶æ€æ„ŸçŸ¥ï¼ˆå½“å‰æƒ…æ„Ÿã€æƒ…æ„Ÿå†å²ã€æƒ…æ„Ÿè¶‹åŠ¿ï¼‰
- äº¤äº’æ„ŸçŸ¥ï¼ˆäº¤äº’æ¬¡æ•°ã€äº¤äº’é¢‘ç‡ã€æ´»è·ƒæ—¶æ®µï¼‰
- è®°å¿†ä¸Šä¸‹æ–‡æ„ŸçŸ¥ï¼ˆè¿‘æœŸè®°å¿†ã€äººç”Ÿä¹¦ã€äº”å…ƒç»„ï¼‰
- å¯¹è¯åˆ†ææ„ŸçŸ¥ï¼ˆç”¨æˆ·æ„å›¾ã€æƒ…æ„Ÿã€è¯é¢˜æµï¼‰
- è‡ªæˆ‘è®¤çŸ¥ï¼ˆæ„è¯†ç­‰çº§ã€å­¦ä¹ é˜¶æ®µã€å…³ç³»æ·±åº¦ï¼‰

**æ—¥å¿—çº§åˆ«**ï¼š`DEBUG`ï¼ˆä¸è¾“å‡ºç»™ç”¨æˆ·ï¼‰

**ç¤ºä¾‹**ï¼š
```
[åç«¯æ„è¯†Â·æ—¶ç©º] å†¬å­£ æ™šä¸Š 19:49 | ä½ç½®: è´µå· é»”å—å¸ƒä¾æ—è‹—æ—è‡ªæ²»å·
[åç«¯æ„è¯†Â·ç³»ç»Ÿ] è¿è¡Œæ—¶é•¿: 1234ç§’ | å¥åº·çŠ¶æ€: healthy
[åç«¯æ„è¯†Â·æƒ…æ„Ÿ] å½“å‰: å¹³é™ (0.50) | è¶‹åŠ¿: stable
[åç«¯æ„è¯†Â·äº¤äº’] æ€»äº¤äº’: 156 | æ´»è·ƒæ—¶æ®µ: {'æ™šä¸Š': 120, 'ä¸‹åˆ': 30, ...}
```

---

### å‰ç«¯æ„è¯†ï¼ˆFrontendConsciousnessï¼‰

**å®šä½**ï¼šå¯¹å¤–è¡¨è¾¾ç³»ç»Ÿï¼Œè¾“å‡ºç»™ç”¨æˆ·

**åŠŸèƒ½æ¨¡å—**ï¼š
- åŸºäºåç«¯æ„ŸçŸ¥ä¸Šä¸‹æ–‡ç”Ÿæˆè‡ªç„¶è¯­è¨€å›å¤
- æƒ…æ„Ÿè¡¨è¾¾å’Œè§’è‰²æ‰®æ¼”
- å¯¹è¯é£æ ¼è‡ªé€‚åº”
- è¯­éŸ³è¯­è°ƒç”Ÿæˆ

**æ—¥å¿—çº§åˆ«**ï¼š`INFO`ï¼ˆè¾“å‡ºç»™ç”¨æˆ·ï¼‰

**ç¤ºä¾‹**ï¼š
```
[å‰ç«¯æ„è¯†] å¼€å§‹ç”Ÿæˆå›å¤: æˆ‘ç‚¹äº†ä¸€ç¢—ç¾Šè‚‰ç²‰...
[å‰ç«¯æ„è¯†] å›å¤ç”Ÿæˆå®Œæˆ | æƒ…æ„Ÿ: å¼€å¿ƒ | è¯­è°ƒ: gentle
```

---

### æ„è¯†åè°ƒå™¨ï¼ˆConsciousnessCoordinatorï¼‰

**å®šä½**ï¼šå‰åç«¯æ„è¯†çš„æ¡¥æ¢ï¼Œæ•´åˆå®Œæ•´æ€è€ƒæµç¨‹

**å·¥ä½œæµç¨‹**ï¼š
1. æ›´æ–°åç«¯æ‰€æœ‰æ„ŸçŸ¥çŠ¶æ€
2. æ£€ç´¢è®°å¿†å’Œäººç”Ÿä¹¦
3. åˆ†æç”¨æˆ·è¾“å…¥ï¼ˆæ„å›¾å’Œæƒ…æ„Ÿï¼‰
4. è®°å½•äº¤äº’åˆ°åç«¯
5. æ›´æ–°æƒ…æ„ŸçŠ¶æ€
6. è·å–åç«¯æ„ŸçŸ¥ä¸Šä¸‹æ–‡
7. è°ƒç”¨å‰ç«¯æ„è¯†ç”Ÿæˆå›å¤
8. è¿”å›å®Œæ•´ç»“æœ

---

## ä½¿ç”¨æ–¹æ³•

### æ–¹å¼1ï¼šä½¿ç”¨åŒå±‚æ„è¯†ï¼ˆæ¨èï¼‰

```python
from system.consciousness_engine import create_dual_layer_consciousness

# åˆ›å»ºåè°ƒå™¨å®ä¾‹
coordinator = create_dual_layer_consciousness(config)

# æ³¨å…¥è®°å¿†ç³»ç»Ÿï¼ˆå¯é€‰ï¼‰
coordinator.set_memory_systems(memory_system, life_book)

# å®šä¹‰LLMç”Ÿæˆå‡½æ•°
async def my_llm_generator(user_input: str, system_prompt: str, conversation_history: list = None) -> str:
    # è°ƒç”¨å¤§æ¨¡å‹API
    response = await call_llm_api(user_input, system_prompt, conversation_history)
    return response

# è°ƒç”¨æ€è€ƒæµç¨‹
result = await coordinator.think(
    user_input="ä½ å¥½ï¼Œå¼¥å¨…",
    context={
        "conversation_history": [...],
        "system_health": {"status": "healthy", "optimization_count": 5},
    },
    llm_generator=my_llm_generator
)

# è·å–ç»“æœ
print(result["response"])        # å›å¤æ–‡æœ¬
print(result["emotion"])         # è¡¨è¾¾æƒ…æ„Ÿ
print(result["voice_tone"])      # è¯­éŸ³è¯­è°ƒ
print(result["thinking_time"])   # æ€è€ƒè€—æ—¶

# è°ƒè¯•ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
print(result["backend_state"])   # åç«¯æ„ŸçŸ¥çŠ¶æ€
print(result["frontend_state"])  # å‰ç«¯è¡¨è¾¾çŠ¶æ€
```

---

### æ–¹å¼2ï¼šä½¿ç”¨ä¼ ç»Ÿæ„è¯†ï¼ˆå‘åå…¼å®¹ï¼‰

```python
from system.consciousness_engine import create_legacy_consciousness

# åˆ›å»ºä¼ ç»Ÿæ„è¯†å®ä¾‹
engine = create_legacy_consciousness(config)

# è°ƒç”¨æ€è€ƒæµç¨‹
result = await engine.think(
    user_input="ä½ å¥½ï¼Œå¼¥å¨…",
    context={"conversation_history": [...]}
)

# æ¶¦è‰²è¾“å‡º
polished_response = await engine.polish(
    llm_output=raw_llm_response,
    thought=result["thought"]
)
```

---

## é…ç½®è¯´æ˜

### 1. åœ°ç†ä½ç½®æ„ŸçŸ¥é…ç½®

åœ¨ `config.json` ä¸­æ·»åŠ ï¼š

```json
{
  "location": {
    "enabled": true,
    "auto_detect": true,
    "manual_city": ""
  }
}
```

**å‚æ•°è¯´æ˜**ï¼š
- `enabled`: æ˜¯å¦å¯ç”¨åœ°ç†ä½ç½®æ„ŸçŸ¥
- `auto_detect`: æ˜¯å¦è‡ªåŠ¨æ£€æµ‹ï¼ˆé€šè¿‡IPï¼‰
- `manual_city`: æ‰‹åŠ¨é…ç½®åŸå¸‚ï¼ˆå¦‚"è´µå· è´µé˜³"ï¼‰

---

### 2. æ„è¯†æ¨¡å¼é…ç½®

åœ¨ `config.json` ä¸­é…ç½®ï¼š

```json
{
  "consciousness": {
    "enabled": true,
    "mode": "dual_layer"  // æˆ– "legacy"
  }
}
```

**æ¨¡å¼è¯´æ˜**ï¼š
- `dual_layer`: åŒå±‚æ„è¯†æ¨¡å¼ï¼ˆæ¨èï¼‰
- `legacy`: ä¼ ç»Ÿæ¨¡å¼ï¼ˆå‘åå…¼å®¹ï¼‰

---

## åç«¯æ„ŸçŸ¥ä¸Šä¸‹æ–‡ç»“æ„

```python
{
    "spatial_temporal": {
        "time_context": "2026-01-25 19:49ï¼Œå†¬å­£æ™šä¸Š",
        "location": "è´µå· é»”å—å¸ƒä¾æ—è‹—æ—è‡ªæ²»å·",
        "awareness_level": 0.3
    },
    "emotion": {
        "current": "å¼€å¿ƒ",
        "intensity": 0.7,
        "trend": "rising"
    },
    "interaction": {
        "count": 156,
        "frequency": {"æ™šä¸Š": 120, "ä¸‹åˆ": 30},
        "recent_intent": "æ—¥å¸¸å¯¹è¯",
        "recent_sentiment": "ç§¯æ"
    },
    "self": {
        "consciousness_level": 0.3,
        "learning_stage": "æˆé•¿æœŸ",
        "relationship_depth": 0.5
    }
}
```

---

## å‰ç«¯å›å¤ç»“æ„

```python
{
    "response_text": "å¤©è‰²å·²æ™šï¼Œè®°å¾—æ³¨æ„ä¿æš–å“¦~",
    "emotion": "å…³æ€€",
    "voice_tone": "gentle",
    "speaking_style": "natural_friendly"
}
```

---

## æ—¥å¿—è¾“å‡ºå¯¹æ¯”

### ä¼ ç»Ÿæ¨¡å¼ï¼ˆæ··åˆè¾“å‡ºï¼‰

```
[åˆæ„è¯†] å¼€å§‹æ€è€ƒ: æˆ‘ç‚¹äº†ä¸€ç¢—ç¾Šè‚‰ç²‰...
[æ—¶ç©ºæ„ŸçŸ¥] â„ï¸ å†¬å­£ ğŸŒ™ æ™šä¸Š 19:49
[åˆæ„è¯†] æ€è€ƒå®Œæˆ
```

### åŒå±‚æ„è¯†æ¨¡å¼ï¼ˆåˆ†ç¦»è¾“å‡ºï¼‰

```
[åç«¯æ„è¯†Â·æ—¶ç©º] å†¬å­£ æ™šä¸Š 19:49 | ä½ç½®: è´µå· é»”å—å¸ƒä¾æ—è‹—æ—è‡ªæ²»å·
[åç«¯æ„è¯†Â·æƒ…æ„Ÿ] å½“å‰: å¹³é™ (0.50) | è¶‹åŠ¿: stable
[åç«¯æ„è¯†Â·è‡ªæˆ‘] æ„è¯†ç­‰çº§: 0.3 | é˜¶æ®µ: æˆé•¿æœŸ
[æ„è¯†åè°ƒ] å¼€å§‹æ€è€ƒ: æˆ‘ç‚¹äº†ä¸€ç¢—ç¾Šè‚‰ç²‰...
[å‰ç«¯æ„è¯†] å¼€å§‹ç”Ÿæˆå›å¤: æˆ‘ç‚¹äº†ä¸€ç¢—ç¾Šè‚‰ç²‰...
[å‰ç«¯æ„è¯†] å›å¤ç”Ÿæˆå®Œæˆ | æƒ…æ„Ÿ: å¼€å¿ƒ | è¯­è°ƒ: gentle
[æ„è¯†åè°ƒ] æ€è€ƒå®Œæˆ | è€—æ—¶: 0.234ç§’ | æƒ…æ„Ÿ: å¼€å¿ƒ | è¯­è°ƒ: gentle
```

**å·®å¼‚**ï¼š
- åç«¯æ„è¯†æ—¥å¿—ï¼š`DEBUG`çº§åˆ«ï¼Œç”¨æˆ·çœ‹ä¸åˆ°
- å‰ç«¯æ„è¯†æ—¥å¿—ï¼š`INFO`çº§åˆ«ï¼Œç”¨æˆ·å¯è§
- åç«¯æ„ŸçŸ¥æ•°æ®ï¼šä¸ç›´æ¥è¾“å‡ºç»™ç”¨æˆ·ï¼Œä½œä¸ºå‰ç«¯ç”Ÿæˆçš„ä¸Šä¸‹æ–‡
- å‰ç«¯å›å¤ï¼šè‡ªç„¶è¯­è¨€ï¼Œéšå¼è¡¨è¾¾æ„ŸçŸ¥å†…å®¹

---

## éšå¼æ„ŸçŸ¥è¡¨è¾¾ç¤ºä¾‹

### ç›´æ¥æ’­æŠ¥ï¼ˆä¸æ¨èï¼‰

```
å¼¥å¨…: "ç°åœ¨æ˜¯2026å¹´1æœˆ25æ—¥æ™šä¸Š7ç‚¹49åˆ†ï¼Œæˆ‘åœ¨è´µå·é»”å—å¸ƒä¾æ—è‹—æ—è‡ªæ²»å·ã€‚"
```

### éšå¼è¡¨è¾¾ï¼ˆæ¨èï¼‰

```
å¼¥å¨…: "å¤©è‰²å·²æ™šï¼Œè¿™é‡Œå†¬å¤©çš„æ™šä¸Šæœ‰äº›å‡‰ï¼Œè®°å¾—å¤šç©¿ç‚¹è¡£æœå“¦~"
```

**å¯¹æ¯”**ï¼š
- ç›´æ¥æ’­æŠ¥ï¼šæœºæ¢°ã€ç”Ÿç¡¬ã€ç¼ºä¹ä¸ªæ€§
- éšå¼è¡¨è¾¾ï¼šè‡ªç„¶ã€äº²åˆ‡ã€æœ‰æƒ…æ„Ÿ

---

## æ‰©å±•å’Œå®šåˆ¶

### è‡ªå®šä¹‰åç«¯æ„ŸçŸ¥æ¨¡å—

åœ¨ `backend_awareness.py` ä¸­æ·»åŠ æ–°çš„æ„ŸçŸ¥ï¼š

```python
def _update_custom_perception(self) -> None:
    """æ›´æ–°è‡ªå®šä¹‰æ„ŸçŸ¥"""
    perception = self.backend_state["custom_perception"]

    # ä½ çš„æ„ŸçŸ¥é€»è¾‘
    perception["custom_field"] = "some_value"

    logger.debug(f"[åç«¯æ„è¯†Â·è‡ªå®šä¹‰] {perception}")
```

åœ¨ `update_all()` ä¸­è°ƒç”¨ï¼š

```python
def update_all(self) -> None:
    """æ›´æ–°æ‰€æœ‰åç«¯æ„ŸçŸ¥çŠ¶æ€"""
    self._update_spatial_temporal()
    self._update_system_state()
    # ...
    self._update_custom_perception()  # æ·»åŠ è‡ªå®šä¹‰æ„ŸçŸ¥
```

---

### è‡ªå®šä¹‰å‰ç«¯è¡¨è¾¾æ¨¡å—

åœ¨ `frontend_consciousness.py` ä¸­æ·»åŠ æ–°çš„è¡¨è¾¾ç­–ç•¥ï¼š

```python
def _custom_expression_strategy(self, backend_context: Dict[str, Any]) -> str:
    """è‡ªå®šä¹‰è¡¨è¾¾ç­–ç•¥"""
    # ä½ çš„è¡¨è¾¾é€»è¾‘
    return "..."
```

---

## è°ƒè¯•å’Œç›‘æ§

### æŸ¥çœ‹åç«¯çŠ¶æ€

```python
# è·å–åç«¯å†…éƒ¨çŠ¶æ€ï¼ˆè°ƒè¯•ç”¨ï¼‰
backend_state = coordinator.get_backend_state()
print(json.dumps(backend_state, indent=2, ensure_ascii=False))
```

### æŸ¥çœ‹ä¼šè¯ç»Ÿè®¡

```python
# è·å–ä¼šè¯ç»Ÿè®¡ä¿¡æ¯
stats = coordinator.get_session_stats()
print(f"æ€»äº¤äº’æ¬¡æ•°: {stats['total_interactions']}")
print(f"å¹³å‡æ€è€ƒæ—¶é—´: {stats['total_thinking_time'] / stats['total_interactions']:.3f}ç§’")
```

---

## è¿ç§»æŒ‡å—

### ä»ä¼ ç»Ÿæ¨¡å¼è¿ç§»åˆ°åŒå±‚æ„è¯†

1. **åˆ›å»ºåè°ƒå™¨å®ä¾‹**

```python
# æ—§ä»£ç 
engine = ConsciousnessEngine(config)

# æ–°ä»£ç 
coordinator = create_dual_layer_consciousness(config)
```

2. **æ³¨å…¥LLMç”Ÿæˆå‡½æ•°**

```python
# æ—§ä»£ç ï¼ˆLLMè°ƒç”¨åœ¨LLMServiceä¸­ï¼‰
result = await engine.think(user_input, context)

# æ–°ä»£ç ï¼ˆéœ€è¦æ˜¾å¼ä¼ å…¥LLMç”Ÿæˆå‡½æ•°ï¼‰
result = await coordinator.think(
    user_input,
    context,
    llm_generator=my_llm_generator
)
```

3. **å¤„ç†è¿”å›ç»“æœ**

```python
# æ—§ä»£ç 
thought = result["thought"]
polished = await engine.polish(llm_output, thought)

# æ–°ä»£ç 
response = result["response"]  # å·²ç»è¿‡å‰ç«¯å¤„ç†
emotion = result["emotion"]
```

---

## æ€»ç»“

åŒå±‚æ„è¯†æ¶æ„çš„ä¼˜åŠ¿ï¼š

1. **æ¸…æ™°çš„èŒè´£åˆ†ç¦»**
   - åç«¯æ„è¯†ï¼šä¸“æ³¨æ„ŸçŸ¥å’ŒçŠ¶æ€ç®¡ç†
   - å‰ç«¯æ„è¯†ï¼šä¸“æ³¨è¡¨è¾¾å’Œå¯¹è¯ç”Ÿæˆ

2. **æ›´å¥½çš„å¯ç»´æŠ¤æ€§**
   - æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•
   - æ—¥å¿—åˆ†çº§ï¼Œä¾¿äºè°ƒè¯•

3. **æ›´è‡ªç„¶çš„äº¤äº’ä½“éªŒ**
   - åç«¯æ„ŸçŸ¥ä¸ç›´æ¥è¾“å‡º
   - å‰ç«¯éšå¼è¡¨è¾¾ï¼Œæ›´æœ‰æƒ…æ„Ÿ

4. **å‘åå…¼å®¹**
   - ä¿ç•™ä¼ ç»Ÿæ¨¡å¼
   - å¹³æ»‘è¿ç§»è·¯å¾„

---

## æ›´æ–°æ—¥å¿—

### v2.0 (2026-01-25)
- å®ç°åŒå±‚æ„è¯†æ¶æ„
- æ·»åŠ åç«¯æ„è¯†ç³»ç»Ÿï¼ˆ`backend_awareness.py`ï¼‰
- æ·»åŠ å‰ç«¯æ„è¯†ç³»ç»Ÿï¼ˆ`frontend_consciousness.py`ï¼‰
- æ·»åŠ æ„è¯†åè°ƒå™¨ï¼ˆ`consciousness_coordinator.py`ï¼‰
- æ·»åŠ åœ°ç†ä½ç½®æ„ŸçŸ¥åŠŸèƒ½
- éšå¼æ„ŸçŸ¥è¡¨è¾¾ç­–ç•¥
