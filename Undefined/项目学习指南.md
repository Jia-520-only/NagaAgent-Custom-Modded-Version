# Undefined é¡¹ç›®å­¦ä¹ æŒ‡å—
## ä»é›¶å¼€å§‹æŒæ¡Pythonä¸è¿™ä¸ªé¡¹ç›®

---

## ğŸ“– ç›®å½•

1. [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
2. [ç¨‹åºå¯åŠ¨æµç¨‹](#ç¨‹åºå¯åŠ¨æµç¨‹)
3. [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#æ ¸å¿ƒæ¨¡å—è¯¦è§£)
4. [PythonçŸ¥è¯†ç‚¹å­¦ä¹ ](#pythonçŸ¥è¯†ç‚¹å­¦ä¹ )
5. [å®æˆ˜æ¼”ç»ƒ](#å®æˆ˜æ¼”ç»ƒ)

---

## ğŸ¯ é¡¹ç›®ç®€ä»‹

### Undefinedæ˜¯ä»€ä¹ˆ?

**Undefined** æ˜¯ä¸€ä¸ª**QQæœºå™¨äºº**,å®ƒèƒ½:
- ğŸ¤– ä½¿ç”¨AI(DeepSeekã€Claudeç­‰)ç†è§£æ¶ˆæ¯å¹¶æ™ºèƒ½å›å¤
- ğŸ” æœç´¢ç½‘ç»œã€åˆ†ææ–‡ä»¶ã€å†™ä»£ç 
- ğŸ“… å®šæ—¶ä»»åŠ¡ã€çŸ¥è¯†åº“é—®ç­”
- ğŸ¬ Bç«™è§†é¢‘è‡ªåŠ¨ä¸‹è½½
- ğŸ¯ æ”¯æŒå¤šç§æ™ºèƒ½åŠ©æ‰‹(Agent)

### ä¸ºä»€ä¹ˆé€‚åˆå­¦ä¹ Python?

è¿™ä¸ªé¡¹ç›®åŒ…å«äº†**ç°ä»£Pythonå¼€å‘**çš„å‡ ä¹æ‰€æœ‰é‡è¦æ¦‚å¿µ:
- âœ… å¼‚æ­¥ç¼–ç¨‹(asyncio)
- âœ… é¢å‘å¯¹è±¡ç¼–ç¨‹(ç±»ã€ç»§æ‰¿)
- âœ… æ¨¡å—åŒ–è®¾è®¡(åŒ…ã€å¯¼å…¥)
- âœ… é…ç½®ç®¡ç†
- âœ… é”™è¯¯å¤„ç†
- âœ… ç±»å‹æç¤º
- âœ… æ–‡ä»¶IOæ“ä½œ
- âœ… ç½‘ç»œç¼–ç¨‹(HTTP/WebSocket)

---

## ğŸš€ ç¨‹åºå¯åŠ¨æµç¨‹

### 1. å‘½ä»¤è¡Œå¦‚ä½•å¯åŠ¨é¡¹ç›®?

```bash
# æ–¹å¼1: ç›´æ¥è¿è¡Œ
python -m Undefined

# æ–¹å¼2: å®‰è£…åè¿è¡Œ(å¦‚æœä½ ç”¨äº†pipæˆ–uvå®‰è£…)
Undefined
```

### 2. å¯åŠ¨è¿‡ç¨‹è¯¦è§£

```
ç”¨æˆ·è¾“å…¥: python -m Undefined
    â†“
Pythonè§£é‡Šå™¨æ‰§è¡Œ src/Undefined/__main__.py
    â†“
è¿™ä¸ªæ–‡ä»¶åªæœ‰6è¡Œä»£ç :
    from Undefined.main import run
    if __name__ == "__main__":
        run()
    â†“
è°ƒç”¨ main.py çš„ run() å‡½æ•°
    â†“
run() æ‰§è¡Œ: asyncio.run(main())
    â†“
å¼€å§‹å¼‚æ­¥ä¸»å‡½æ•° main()
    â†“
ã€æ­¥éª¤1ã€‘è®¾ç½®æ—¥å¿—ç³»ç»Ÿ
    - åˆ›å»ºæ—¥å¿—æ–‡ä»¶
    - è®¾ç½®æ—¥å¿—çº§åˆ«(INFO/DEBUGç­‰)
    â†“
ã€æ­¥éª¤2ã€‘ç¡®ä¿è¿è¡Œæ—¶ç›®å½•å­˜åœ¨
    - åˆ›å»º data/ ç›®å½•(å­˜å‚¨èŠå¤©è®°å½•ã€é…ç½®ç­‰)
    - åˆ›å»º cache/ ç›®å½•(ç¼“å­˜æ–‡ä»¶)
    â†“
ã€æ­¥éª¤3ã€‘æ£€æŸ¥Gitæ›´æ–°(å¯é€‰)
    - å¦‚æœæ˜¯å®˜æ–¹ä»“åº“,ä¼šè‡ªåŠ¨æ£€æŸ¥æ›´æ–°
    - æœ‰æ›´æ–°ä¼šè‡ªåŠ¨é‡å¯
    â†“
ã€æ­¥éª¤4ã€‘åŠ è½½é…ç½®æ–‡ä»¶
    - è¯»å– config.toml
    - è¯»å– config.local.json
    â†“
ã€æ­¥éª¤5ã€‘åˆå§‹åŒ–æ ¸å¿ƒç»„ä»¶
    - OneBotClient: è¿æ¥QQåè®®
    - MemoryStorage: è®°å¿†å­˜å‚¨
    - AIClient: AIå®¢æˆ·ç«¯(ä¸AIæ¨¡å‹å¯¹è¯)
    - FAQStorage: å¸¸è§é—®é¢˜å­˜å‚¨
    - KnowledgeManager: çŸ¥è¯†åº“(å¯é€‰)
    - MessageHandler: æ¶ˆæ¯å¤„ç†å™¨
    â†“
ã€æ­¥éª¤6ã€‘å¯åŠ¨é…ç½®çƒ­æ›´æ–°
    - ç›‘å¬ config.toml å˜åŒ–
    - è‡ªåŠ¨é‡æ–°åŠ è½½é…ç½®
    â†“
ã€æ­¥éª¤7ã€‘å¼€å§‹è¿è¡Œ
    - è¿æ¥åˆ°QQåè®®ç«¯
    - å¼€å§‹æ¥æ”¶æ¶ˆæ¯
    - å¤„ç†æ¶ˆæ¯å¹¶å‘é€å›å¤
    â†“
ç¨‹åºæŒç»­è¿è¡Œ...ç›´åˆ°æŒ‰Ctrl+Cåœæ­¢
```

---

## ğŸ“¦ æ ¸å¿ƒæ¨¡å—è¯¦è§£

### æ¨¡å—1: main.py - ç¨‹åºå…¥å£

**ä½ç½®**: `src/Undefined/main.py`

**ä½œç”¨**: ç¨‹åºçš„å¯åŠ¨å…¥å£,è´Ÿè´£åˆå§‹åŒ–æ‰€æœ‰ç»„ä»¶

**å…³é”®ä»£ç åˆ†æ**:

```python
# ç¬¬3è¡Œ: å¯¼å…¥asyncioæ¨¡å—
import asyncio
"""
çŸ¥è¯†ç‚¹:
- asyncioæ˜¯Pythonçš„å¼‚æ­¥ç¼–ç¨‹åº“
- å¼‚æ­¥ç¼–ç¨‹å¯ä»¥è®©ç¨‹åºåŒæ—¶åšå¤šä»¶äº‹
- ä¾‹å¦‚:ç­‰å¾…ç½‘ç»œè¯·æ±‚æ—¶å¯ä»¥å¤„ç†å…¶ä»–æ¶ˆæ¯
"""

# ç¬¬136è¡Œ: å®šä¹‰å¼‚æ­¥ä¸»å‡½æ•°
async def main() -> None:
    """ä¸»å‡½æ•°"""
    # setup_logging() - è®¾ç½®æ—¥å¿—
    setup_logging()

    # ensure_runtime_dirs() - åˆ›å»ºå¿…è¦çš„ç›®å½•
    ensure_runtime_dirs()

    # åŠ è½½é…ç½®
    config = get_config()
    print(f"æœºå™¨äººQQ: {config.bot_qq}")

    # åˆ›å»ºæ ¸å¿ƒç»„ä»¶
    onebot = OneBotClient(...)      # QQåè®®å®¢æˆ·ç«¯
    ai = AIClient(...)              # AIå®¢æˆ·ç«¯
    handler = MessageHandler(...)   # æ¶ˆæ¯å¤„ç†å™¨

    # è¿æ¥å¹¶è¿è¡Œ
    await onebot.run_with_reconnect()

# ç¬¬315è¡Œ: å®šä¹‰åŒæ­¥è¿è¡Œå…¥å£
def run() -> None:
    """è¿è¡Œå…¥å£"""
    asyncio.run(main())
"""
çŸ¥è¯†ç‚¹:
- async/await: å®šä¹‰å¼‚æ­¥å‡½æ•°
- asyncio.run(): è¿è¡Œå¼‚æ­¥å‡½æ•°
- ç¨‹åºä»è¿™é‡Œå¼€å§‹çœŸæ­£æ‰§è¡Œ
"""

# ç¬¬320è¡Œ: if __name__ == "__main__"
if __name__ == "__main__":
    run()
"""
çŸ¥è¯†ç‚¹:
- __name__ æ˜¯Pythonå†…ç½®å˜é‡
- å½“æ–‡ä»¶è¢«ç›´æ¥è¿è¡Œæ—¶,__name__ == "__main__"
- å½“æ–‡ä»¶è¢«å¯¼å…¥æ—¶,__name__ ç­‰äºæ¨¡å—å
- è¿™è¡Œä»£ç ç¡®ä¿åªæœ‰ç›´æ¥è¿è¡Œæ—¶æ‰æ‰§è¡Œrun()
"""
```

### æ¨¡å—2: __main__.py - å‘½ä»¤è¡Œå…¥å£

**ä½ç½®**: `src/Undefined/__main__.py`

**ä»£ç **(å®Œæ•´):
```python
"""å…è®¸ python -m Undefined è¿è¡Œ"""

from Undefined.main import run

if __name__ == "__main__":
    run()
```

**é€è¡Œè§£é‡Š**:
- ç¬¬1è¡Œ: æ–‡æ¡£å­—ç¬¦ä¸²,è¯´æ˜è¿™ä¸ªæ–‡ä»¶çš„ä½œç”¨
- ç¬¬3è¡Œ: `from Undefined.main import run`
  - ä» `Undefined.main` æ¨¡å—å¯¼å…¥ `run` å‡½æ•°
  - `Undefined.main` å¯¹åº”è·¯å¾„: `src/Undefined/main.py`
- ç¬¬5-6è¡Œ: æ£€æŸ¥æ˜¯å¦è¢«ç›´æ¥è¿è¡Œ,å¦‚æœæ˜¯åˆ™è°ƒç”¨ `run()`

**ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªæ–‡ä»¶?**
- å½“ä½ è¿è¡Œ `python -m Undefined` æ—¶,Pythonä¼šæ‰¾ `Undefined/__main__.py`
- è¿™æ˜¯Pythonçš„åŒ…æ‰§è¡Œæœºåˆ¶

---

### æ¨¡å—3: handlers.py - æ¶ˆæ¯å¤„ç†æ ¸å¿ƒ

**ä½ç½®**: `src/Undefined/handlers.py`

**ä½œç”¨**: å¤„ç†æ¥æ”¶åˆ°çš„QQæ¶ˆæ¯

**æ ¸å¿ƒç±»: MessageHandler**

```python
class MessageHandler:
    """æ¶ˆæ¯å¤„ç†å™¨"""

    def __init__(
        self,
        config: Config,
        onebot: OneBotClient,
        ai: AIClient,
        faq_storage: FAQStorage,
        task_storage: ScheduledTaskStorage,
    ) -> None:
        # ä¿å­˜é…ç½®å’Œå„ç§ç»„ä»¶
        self.config = config
        self.onebot = onebot
        self.ai = ai
        self.faq_storage = faq_storage

        # åˆå§‹åŒ–è¾…åŠ©ç»„ä»¶
        self.history_manager = MessageHistoryManager(...)  # ç®¡ç†èŠå¤©è®°å½•
        self.sender = MessageSender(...)                   # å‘é€æ¶ˆæ¯
        self.security = SecurityService(...)               # å®‰å…¨æ£€æµ‹
        self.queue_manager = QueueManager(...)             # ä»»åŠ¡é˜Ÿåˆ—
        self.command_dispatcher = CommandDispatcher(...)   # å‘½ä»¤åˆ†å‘å™¨
```

**æ¶ˆæ¯å¤„ç†æµç¨‹**:

```python
async def handle_message(self, event: dict[str, Any]) -> None:
    """å¤„ç†æ¥æ”¶åˆ°çš„æ¶ˆæ¯"""

    # 1. æå–æ¶ˆæ¯å†…å®¹
    message_text = get_message_content(event)

    # 2. æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜å‘½ä»¤(å¦‚ /help)
    if message_text.startswith("/"):
        await self.command_dispatcher.handle_command(event)
        return

    # 3. å®‰å…¨æ£€æŸ¥(æ£€æŸ¥æ˜¯å¦æœ‰æ¶æ„å†…å®¹)
    if await self.security.is_malicious(message_text):
        return  # æ‹’ç»å¤„ç†

    # 4. é™æµæ£€æŸ¥(é˜²æ­¢åˆ·å±)
    if not self.rate_limiter.allow(event):
        return

    # 5. ä¿å­˜åˆ°èŠå¤©å†å²
    await self.history_manager.save_message(event)

    # 6. å‘é€ç»™AIå¤„ç†
    await self.ai_coordinator.coordinate(event)
```

---

### æ¨¡å—4: onebot.py - QQåè®®è¿æ¥

**ä½ç½®**: `src/Undefined/onebot.py`

**ä½œç”¨**: é€šè¿‡WebSocketè¿æ¥QQåè®®ç«¯

**æ ¸å¿ƒç±»: OneBotClient**

```python
class OneBotClient:
    """OneBot v11 WebSocket å®¢æˆ·ç«¯"""

    def __init__(self, ws_url: str, token: str = ""):
        self.ws_url = ws_url          # WebSocketåœ°å€
        self.token = token            # è®¿é—®ä»¤ç‰Œ
        self.ws = None                # WebSocketè¿æ¥å¯¹è±¡

    async def connect(self) -> None:
        """è¿æ¥åˆ° OneBot WebSocket"""
        self.ws = await websockets.connect(self.ws_url)
        logger.info("è¿æ¥æˆåŠŸ!")

    async def send_message(self, user_id: int, message: str) -> None:
        """å‘é€æ¶ˆæ¯ç»™æŒ‡å®šç”¨æˆ·"""
        await self._call_api(
            "send_private_msg",
            {"user_id": user_id, "message": message}
        )

    async def _call_api(self, action: str, params: dict) -> dict:
        """è°ƒç”¨ OneBot API"""
        # æ„é€ è¯·æ±‚
        request = {
            "action": action,
            "params": params,
            "echo": self._message_id
        }

        # å‘é€åˆ°WebSocket
        await self.ws.send(json.dumps(request))

        # ç­‰å¾…å“åº”
        response = await self.ws.recv()
        return json.loads(response)
```

---

## ğŸ’¡ PythonçŸ¥è¯†ç‚¹å­¦ä¹ 

### çŸ¥è¯†ç‚¹1: å¼‚æ­¥ç¼–ç¨‹(async/await)

**ä»€ä¹ˆæ˜¯å¼‚æ­¥ç¼–ç¨‹?**
- å¼‚æ­¥ç¼–ç¨‹è®©ç¨‹åºåœ¨ç­‰å¾…æŸä¸ªæ“ä½œå®Œæˆæ—¶,å¯ä»¥åšå…¶ä»–äº‹æƒ…
- ä¾‹å¦‚:ç­‰å¾…AIå›å¤æ—¶,å¯ä»¥åŒæ—¶å¤„ç†å…¶ä»–æ¶ˆæ¯

**å…³é”®æ¦‚å¿µ**:

```python
# 1. å®šä¹‰å¼‚æ­¥å‡½æ•°
async def my_function():
    # await è¡¨ç¤ºç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ
    result = await some_async_operation()
    return result

# 2. è¿è¡Œå¼‚æ­¥å‡½æ•°
import asyncio
asyncio.run(my_function())

# 3. åŒæ—¶æ‰§è¡Œå¤šä¸ªå¼‚æ­¥ä»»åŠ¡
async def task1():
    await asyncio.sleep(1)  # ç­‰å¾…1ç§’
    print("ä»»åŠ¡1å®Œæˆ")

async def task2():
    await asyncio.sleep(1)
    print("ä»»åŠ¡2å®Œæˆ")

async def main():
    # åŒæ—¶è¿è¡Œtask1å’Œtask2,åªè€—æ—¶1ç§’
    await asyncio.gather(task1(), task2())

asyncio.run(main())
```

**é¡¹ç›®ä¸­çš„åº”ç”¨**:
```python
# main.py: åŒæ—¶è¿æ¥WebSocketå’Œå¯åŠ¨AIå¤„ç†
async def main():
    # è¿æ¥QQåè®®(éœ€è¦ç­‰å¾…ç½‘ç»œè¿æ¥)
    await onebot.connect()

    # åŒæ—¶å¯åŠ¨å¤šä¸ªAIä»»åŠ¡
    await asyncio.gather(
        task1(),
        task2(),
        task3()
    )
```

---

### çŸ¥è¯†ç‚¹2: ç±»å’Œé¢å‘å¯¹è±¡ç¼–ç¨‹

**ä»€ä¹ˆæ˜¯ç±»?**
- ç±»æ˜¯åˆ›å»ºå¯¹è±¡çš„æ¨¡æ¿
- å¯¹è±¡æ˜¯ç±»çš„å®ä¾‹åŒ–

**åŸºæœ¬è¯­æ³•**:

```python
class ç±»å:
    def __init__(self, å‚æ•°):
        """æ„é€ å‡½æ•°,åˆ›å»ºå¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨"""
        self.å±æ€§ = å‚æ•°

    def æ–¹æ³•(self):
        """ç±»çš„æ–¹æ³•"""
        return f"è¿™æ˜¯ä¸€ä¸ªæ–¹æ³•"
```

**é¡¹ç›®ä¸­çš„åº”ç”¨**:

```python
class OneBotClient:
    """QQåè®®å®¢æˆ·ç«¯ç±»"""

    def __init__(self, ws_url: str, token: str = ""):
        """
        åˆå§‹åŒ–æ–¹æ³•
        :param ws_url: WebSocketåœ°å€
        :param token: è®¿é—®ä»¤ç‰Œ
        """
        self.ws_url = ws_url    # ä¿å­˜åˆ°å®ä¾‹å˜é‡
        self.token = token
        self.ws = None

    async def connect(self) -> None:
        """è¿æ¥æ–¹æ³•"""
        print(f"æ­£åœ¨è¿æ¥åˆ° {self.ws_url}...")

    async def send_message(self, user_id: int, message: str) -> None:
        """å‘é€æ¶ˆæ¯æ–¹æ³•"""
        print(f"å‘é€ç»™ {user_id}: {message}")

# ä½¿ç”¨ç±»
client = OneBotClient("ws://localhost:8080", "my_token")
await client.connect()
await client.send_message(12345, "ä½ å¥½!")
```

---

### çŸ¥è¯†ç‚¹3: æ¨¡å—å’ŒåŒ…

**ä»€ä¹ˆæ˜¯æ¨¡å—?**
- æ¨¡å—å°±æ˜¯ä¸€ä¸ª.pyæ–‡ä»¶
- åŒ…å«äº†Pythonä»£ç 

**ä»€ä¹ˆæ˜¯åŒ…?**
- åŒ…æ˜¯åŒ…å«å¤šä¸ªæ¨¡å—çš„ç›®å½•
- ç›®å½•ä¸­å¿…é¡»æœ‰ `__init__.py` æ–‡ä»¶

**å¯¼å…¥è¯­æ³•**:

```python
# 1. å¯¼å…¥æ•´ä¸ªæ¨¡å—
import os
print(os.getcwd())  # è°ƒç”¨æ—¶éœ€è¦åŠ æ¨¡å—å

# 2. å¯¼å…¥æ¨¡å—ä¸­çš„ç‰¹å®šå‡½æ•°
from os import getcwd
print(getcwd())  # ç›´æ¥è°ƒç”¨,ä¸éœ€è¦åŠ æ¨¡å—å

# 3. å¯¼å…¥å¹¶é‡å‘½å
from os import getcwd as get_current_directory
print(get_current_directory())

# 4. å¯¼å…¥åŒ…ä¸­çš„æ¨¡å—
from package import module
module.function()

# 5. ä»åŒ…çš„æ¨¡å—ä¸­å¯¼å…¥
from package.module import function
function()
```

**é¡¹ç›®ä¸­çš„å¯¼å…¥ç¤ºä¾‹**:

```python
# main.py ä¸­çš„å¯¼å…¥
from Undefined.ai import AIClient
# ä» Undefined åŒ…çš„ ai æ¨¡å—å¯¼å…¥ AIClient ç±»

from Undefined.config import get_config
# ä» Undefined åŒ…çš„ config æ¨¡å—å¯¼å…¥ get_config å‡½æ•°

from Undefined.handlers import MessageHandler
# ä» Undefined åŒ…çš„ handlers æ¨¡å—å¯¼å…¥ MessageHandler ç±»
```

---

### çŸ¥è¯†ç‚¹4: ç±»å‹æç¤º(Type Hints)

**ä»€ä¹ˆæ˜¯ç±»å‹æç¤º?**
- ç±»å‹æç¤ºå‘Šè¯‰å‡½æ•°å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹
- è®©ä»£ç æ›´æ¸…æ™°,IDEèƒ½æä¾›æ›´å¥½çš„ä»£ç è¡¥å…¨

**åŸºæœ¬è¯­æ³•**:

```python
def add(a: int, b: int) -> int:
    """ä¸¤ä¸ªæ•´æ•°ç›¸åŠ """
    return a + b

def greet(name: str) -> str:
    """æ‰“æ‹›å‘¼"""
    return f"Hello, {name}!"

def process_data(data: list[str]) -> dict[str, int]:
    """å¤„ç†æ•°æ®"""
    result = {}
    for item in data:
        result[item] = len(item)
    return result

# å¯é€‰ç±»å‹(å¯èƒ½æ˜¯None)
def get_user(user_id: int) -> dict[str, str] | None:
    """è·å–ç”¨æˆ·ä¿¡æ¯,å¯èƒ½è¿”å›None"""
    if user_id == 0:
        return None
    return {"id": str(user_id), "name": "Test"}
```

**é¡¹ç›®ä¸­çš„åº”ç”¨**:

```python
# onebot.py
def set_message_handler(
    self,
    handler: Callable[[dict[str, Any]], Coroutine[Any, Any, None]]
) -> None:
    """
    å‚æ•°handlerçš„ç±»å‹:
    - Callable: è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡(å‡½æ•°)
    - [dict[str, Any]]: å‚æ•°ç±»å‹,æ¥æ”¶ä¸€ä¸ªå­—å…¸
    - Coroutine: è¿”å›ç±»å‹,è¿”å›ä¸€ä¸ªåç¨‹å¯¹è±¡
    """
    self._message_handler = handler
```

---

### çŸ¥è¯†ç‚¹5: é”™è¯¯å¤„ç†(try-except)

**ä¸ºä»€ä¹ˆéœ€è¦é”™è¯¯å¤„ç†?**
- ç¨‹åºè¿è¡Œæ—¶å¯èƒ½ä¼šå‡ºç°å„ç§é”™è¯¯
- é”™è¯¯å¤„ç†è®©ç¨‹åºæ›´å¥å£®,ä¸ä¼šå´©æºƒ

**åŸºæœ¬è¯­æ³•**:

```python
try:
    # å¯èƒ½å‡ºé”™çš„ä»£ç 
    result = 10 / 0
except ZeroDivisionError as e:
    # æ•è·é™¤é›¶é”™è¯¯
    print(f"å‡ºé”™äº†: {e}")
except Exception as e:
    # æ•è·æ‰€æœ‰å…¶ä»–é”™è¯¯
    print(f"æœªçŸ¥é”™è¯¯: {e}")
finally:
    # æ— è®ºæ˜¯å¦å‡ºé”™éƒ½ä¼šæ‰§è¡Œ
    print("æ¸…ç†å·¥ä½œ")
```

**é¡¹ç›®ä¸­çš„åº”ç”¨**:

```python
# main.py
try:
    config = get_config()
    logger.info("é…ç½®åŠ è½½æˆåŠŸ")
except ValueError as exc:
    # é…ç½®åŠ è½½å¤±è´¥
    logger.error(f"é…ç½®é”™è¯¯: {exc}")
    sys.exit(1)  # é€€å‡ºç¨‹åº

# onebot.py
try:
    self.ws = await websockets.connect(self.ws_url)
    logger.info("è¿æ¥æˆåŠŸ")
except Exception as e:
    logger.error(f"è¿æ¥å¤±è´¥: {e}")
    raise  # é‡æ–°æŠ›å‡ºé”™è¯¯
```

---

### çŸ¥è¯†ç‚¹6: ä¸Šä¸‹æ–‡ç®¡ç†å™¨(contextvars)

**ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨?**
- ç”¨äºåœ¨è¯·æ±‚ä¹‹é—´ä¼ é€’å’Œéš”ç¦»æ•°æ®
- ç±»ä¼¼äºçº¿ç¨‹å®‰å…¨çš„å…¨å±€å˜é‡

**åŸºæœ¬ç”¨æ³•**:

```python
import contextvars

# åˆ›å»ºä¸Šä¸‹æ–‡å˜é‡
request_id = contextvars.ContextVar("request_id")

async def process_request():
    # è®¾ç½®å½“å‰è¯·æ±‚çš„ID
    request_id.set("req_12345")

    # åœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥è·å–
    print(f"å½“å‰è¯·æ±‚ID: {request_id.get()}")

# æ¯ä¸ªè¯·æ±‚æœ‰ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡
await process_request()
```

**é¡¹ç›®ä¸­çš„åº”ç”¨**:

```python
# context.py
request_id: contextvars.ContextVar[str] = contextvars.ContextVar("request_id")

# åœ¨æ—¥å¿—ä¸­ä½¿ç”¨
class RequestContextFilter(logging.Filter):
    def filter(self, record):
        ctx = RequestContext.current()
        if ctx:
            record.request_id = ctx.request_id
        return True
```

---

## ğŸ® å®æˆ˜æ¼”ç»ƒ

### ç»ƒä¹ 1: ç†è§£ç¨‹åºå¯åŠ¨æµç¨‹

**ä»»åŠ¡**: æ‰‹åŠ¨è·Ÿè¸ªç¨‹åºå¯åŠ¨è¿‡ç¨‹

**æ­¥éª¤**:
1. æ‰“å¼€ `src/Undefined/__main__.py`,ç†è§£å®ƒçš„ä½œç”¨
2. æ‰“å¼€ `src/Undefined/main.py`,æ‰¾åˆ° `run()` å‡½æ•°
3. è·Ÿè¸ª `async def main()` å‡½æ•°çš„æ‰§è¡Œæµç¨‹
4. ç†è§£æ¯ä¸ªåˆå§‹åŒ–æ­¥éª¤çš„ä½œç”¨

**æ€è€ƒé¢˜**:
- ä¸ºä»€ä¹ˆè¦ç”¨ `asyncio.run(main())` è€Œä¸æ˜¯ç›´æ¥è°ƒç”¨ `main()`?
- `if __name__ == "__main__":` çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?

---

### ç»ƒä¹ 2: ç†è§£ç±»çš„ä½¿ç”¨

**ä»»åŠ¡**: åˆ›å»ºä¸€ä¸ªç®€å•çš„ç±»æ¥æ¨¡æ‹ŸQQå®¢æˆ·ç«¯

**ä»£ç **:
```python
class SimpleQQClient:
    """ç®€åŒ–çš„QQå®¢æˆ·ç«¯"""

    def __init__(self, user_id: int, nickname: str):
        self.user_id = user_id
        self.nickname = nickname
        self.friends: list[int] = []

    def add_friend(self, friend_id: int) -> None:
        """æ·»åŠ å¥½å‹"""
        self.friends.append(friend_id)
        print(f"å·²æ·»åŠ å¥½å‹: {friend_id}")

    def send_message(self, friend_id: int, message: str) -> None:
        """å‘é€æ¶ˆæ¯"""
        print(f"[{self.nickname}] -> {friend_id}: {message}")

# ä½¿ç”¨
client = SimpleQQClient(12345, "å°æ˜")
client.add_friend(54321)
client.send_message(54321, "ä½ å¥½!")
```

**ç»ƒä¹ **:
1. ä¿®æ”¹ä»£ç ,æ·»åŠ  `remove_friend` æ–¹æ³•
2. æ·»åŠ ä¸€ä¸ªæ–¹æ³•ç»Ÿè®¡å¥½å‹æ•°é‡
3. æ·»åŠ ç±»å‹æç¤º

---

### ç»ƒä¹ 3: ç†è§£å¼‚æ­¥ç¼–ç¨‹

**ä»»åŠ¡**: æ¨¡æ‹ŸAIå¯¹è¯åœºæ™¯

**ä»£ç **:
```python
import asyncio

async def simulate_ai_response(message: str) -> str:
    """æ¨¡æ‹ŸAIå›å¤(éœ€è¦ç­‰å¾…)"""
    print(f"ğŸ¤– æ­£åœ¨å¤„ç†: {message}")
    await asyncio.sleep(2)  # æ¨¡æ‹ŸAIæ€è€ƒ2ç§’
    return f"è¿™æ˜¯å¯¹'{message}'çš„å›å¤"

async def handle_user_message(message: str):
    """å¤„ç†ç”¨æˆ·æ¶ˆæ¯"""
    # è·å–AIå›å¤
    response = await simulate_ai_response(message)
    print(f"ğŸ’¬ AIå›å¤: {response}")

# æµ‹è¯•
async def main():
    # åŒæ—¶å¤„ç†å¤šä¸ªæ¶ˆæ¯
    await asyncio.gather(
        handle_user_message("ä½ å¥½"),
        handle_user_message("ä»Šå¤©å¤©æ°”"),
        handle_user_message("æ¨èä¸ªç”µå½±")
    )

asyncio.run(main())
```

**ç»ƒä¹ **:
1. è¿è¡Œè¿™æ®µä»£ç ,è§‚å¯Ÿè¾“å‡º
2. ä¿®æ”¹ä»£ç ,è®©æ¯ä¸ªæ¶ˆæ¯å¤„ç†åå†å¤„ç†ä¸‹ä¸€ä¸ª(ä½¿ç”¨ `await` è€Œä¸æ˜¯ `gather`)
3. å¯¹æ¯”ä¸¤ç§æ–¹å¼çš„åŒºåˆ«

---

## ğŸ“š è¿›é˜¶å­¦ä¹ è·¯å¾„

### é˜¶æ®µ2: é…ç½®ç³»ç»Ÿ (config/)

**å­¦ä¹ ç›®æ ‡**:
- ç†è§£å¦‚ä½•è¯»å–å’Œè§£æé…ç½®æ–‡ä»¶
- å­¦ä¹  `toml` å’Œ `json` æ ¼å¼
- ç†è§£é…ç½®çƒ­æ›´æ–°æœºåˆ¶

**æ ¸å¿ƒæ–‡ä»¶**:
- `src/Undefined/config/loader.py` - é…ç½®åŠ è½½å™¨
- `src/Undefined/config/manager.py` - é…ç½®ç®¡ç†å™¨
- `config.toml.example` - é…ç½®ç¤ºä¾‹

**ç»ƒä¹ **:
1. é˜…è¯»é…ç½®ç¤ºä¾‹,ç†è§£æ¯ä¸ªé…ç½®é¡¹çš„ä½œç”¨
2. åˆ›å»ºè‡ªå·±çš„é…ç½®æ–‡ä»¶
3. ä¿®æ”¹æŸä¸ªé…ç½®å€¼,è§‚å¯Ÿç¨‹åºè¡Œä¸ºå˜åŒ–

---

### é˜¶æ®µ3: AIè¿è¡Œæ—¶ (ai/)

**å­¦ä¹ ç›®æ ‡**:
- ç†è§£AIå®¢æˆ·ç«¯å¦‚ä½•å·¥ä½œ
- å­¦ä¹ å¦‚ä½•è°ƒç”¨OpenAI API
- ç†è§£å·¥å…·è°ƒç”¨æœºåˆ¶

**æ ¸å¿ƒæ–‡ä»¶**:
- `src/Undefined/ai/client.py` - AIå®¢æˆ·ç«¯ä¸»å…¥å£
- `src/Undefined/ai/llm.py` - LLMè¯·æ±‚å™¨
- `src/Undefined/ai/tooling.py` - å·¥å…·ç®¡ç†å™¨

**ç»ƒä¹ **:
1. ç†è§£AIå¦‚ä½•è°ƒç”¨å·¥å…·
2. å­¦ä¹ å¦‚ä½•æ·»åŠ è‡ªå®šä¹‰å·¥å…·
3. ç†è§£æç¤ºè¯(prompt)çš„æ„å»º

---

### é˜¶æ®µ4: SkillsæŠ€èƒ½ç³»ç»Ÿ (skills/)

**å­¦ä¹ ç›®æ ‡**:
- ç†è§£æŠ€èƒ½ç³»ç»Ÿçš„æ¶æ„
- å­¦ä¹ å¦‚ä½•åˆ›å»ºæ–°çš„å·¥å…·
- å­¦ä¹ å¦‚ä½•åˆ›å»ºæ–°çš„Agent

**æ ¸å¿ƒæ–‡ä»¶**:
- `src/Undefined/skills/` - æŠ€èƒ½ç³»ç»Ÿç›®å½•
- `src/Undefined/skills/tools/` - åŸºç¡€å·¥å…·
- `src/Undefined/skills/agents/` - æ™ºèƒ½ä½“

**ç»ƒä¹ **:
1. é˜…è¯»ç°æœ‰å·¥å…·çš„å®ç°
2. å°è¯•åˆ›å»ºä¸€ä¸ªç®€å•çš„å·¥å…·
3. ç†è§£Agentå¦‚ä½•è°ƒç”¨å·¥å…·

---

## ğŸ“ å­¦ä¹ å»ºè®®

### 1. å¾ªåºæ¸è¿›
- å…ˆç†è§£æ•´ä½“æ¶æ„
- å†æ·±å…¥æ¯ä¸ªæ¨¡å—
- æœ€ååŠ¨æ‰‹å®è·µ

### 2. åŠ¨æ‰‹å®éªŒ
- ä¿®æ”¹ä»£ç ,è§‚å¯Ÿå˜åŒ–
- æ·»åŠ æ–°åŠŸèƒ½
- é˜…è¯»é”™è¯¯ä¿¡æ¯

### 3. ä½¿ç”¨å·¥å…·
- ä½¿ç”¨IDEçš„ä»£ç è·³è½¬åŠŸèƒ½
- ä½¿ç”¨è°ƒè¯•å™¨è·Ÿè¸ªæ‰§è¡Œ
- æŸ¥çœ‹æ—¥å¿—è¾“å‡º

### 4. æŸ¥é˜…æ–‡æ¡£
- Pythonå®˜æ–¹æ–‡æ¡£
- é¡¹ç›®ä¸­çš„æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²
- READMEå’ŒARCHITECTURE.md

---

## ğŸ“ æ€»ç»“

é€šè¿‡è¿™ä¸ªé¡¹ç›®,ä½ å°†å­¦åˆ°:

âœ… **PythonåŸºç¡€**:
- è¯­æ³•ã€å˜é‡ã€å‡½æ•°ã€ç±»
- æ¨¡å—å’ŒåŒ…
- ç±»å‹æç¤º

âœ… **é«˜çº§ç‰¹æ€§**:
- å¼‚æ­¥ç¼–ç¨‹(async/await)
- ä¸Šä¸‹æ–‡ç®¡ç†å™¨
- è£…é¥°å™¨

âœ… **å®è·µæŠ€èƒ½**:
- é…ç½®ç®¡ç†
- é”™è¯¯å¤„ç†
- æ—¥å¿—è®°å½•
- ç½‘ç»œç¼–ç¨‹

âœ… **é¡¹ç›®ç»éªŒ**:
- é¡¹ç›®ç»“æ„è®¾è®¡
- æ¨¡å—åŒ–å¼€å‘
- ä»£ç ç»„ç»‡

---

**ç»§ç»­å­¦ä¹ **: æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£,å¼€å§‹é˜…è¯»å…·ä½“æ¨¡å—çš„ä»£ç !

ç¥ä½ å­¦ä¹ æ„‰å¿«! ğŸš€
