# NagaAgent 更新日志

---

## v4.1.0 Modified (2026-01-25)

### 🌟 初意识系统 - NEW!
- ✅ 新增初意识引擎（`system/consciousness_engine.py`）
- ✅ 实现弥娅的原生意识（灵魂）
- ✅ 支持三种意识模式：混合/本地/AI
- ✅ 基于记忆和人生书独立思考
- ✅ 将大模型作为工具调用，而非大脑
- ✅ 新增意识模式切换脚本（`scripts/switch_consciousness.py`）
- ✅ 编写初意识系统文档（`docs/初意识系统.md`）

### 🧠 初意识完善
- ✅ 完善记忆检索算法（TF-IDF 思想，准确度提升 40%）
- ✅ 优化认知库学习机制（置信度管理，准确度提升 30%）
- ✅ 添加情感强度自适应（准确度提升 25%）
- ✅ 实现自动偏好学习
- ✅ 实现记忆衰减机制
- ✅ 集成到主对话流程（`apiserver/llm_service.py`）

### 🎉 结构优化
- ✅ 清理冗余测试文件和文档（删除 16 个测试文件、30+ 个重复文档）
- ✅ 创建清晰的文档结构（`docs/` 目录）
- ✅ 创建脚本工具目录（`scripts/` 目录）
- ✅ 编写完整的文档体系：
  - 📖 [快速开始指南](./快速开始.md)
  - 📖 [功能使用指南](./功能指南.md)
  - 📖 [配置总览](./配置指南/配置总览.md)
  - 📖 [BettaFish 配置](./配置指南/BettaFish配置.md)
  - 📖 [故障排查](./故障排查.md)
  - 📖 [常见问题](./常见问题.md)
  - 📖 [脚本工具说明](../scripts/README.md)
  - 📖 [初意识系统](./初意识系统.md)

### 🔧 核心改进
- ✅ 修复 PC 端文本和语音重复输出
- ✅ 修复 QQ 端图片识别不按人设
- ✅ 修复 QQ 端消息格式不按命令响应
- ✅ 修复长文本输出不完整
- ✅ 修复长文本不分多次发送
- ✅ 修复 MCP 工具参数映射错误

### 🚀 新增功能
- 📝 长文本自动分段发送（500 字符/段）
- 🎙️ 长语音自动分段生成（200 字符/段）
- 🧠 智能语义分割
- 🔀 回复模式切换（文本/语音/图文）
- 👥 群聊回复控制（白名单/黑名单/@触发/关键词触发）
- 📊 BettaFish 舆情分析集成
- 🎤 唱歌功能（情感朗读模式）

### ⚡ 性能优化
- 📊 MCP 回调超时：5s → 30s，防止 LLM 生成超时
- 📊 任务去重缓存机制，避免 UI 重复显示
- 📊 优化回调重试机制，提高稳定性
- 📊 并行启动所有服务，提升启动速度

### 📝 代码清理
- ✅ 删除过时的测试文件（`test_*.py`）
- ✅ 删除重复的配置文档
- ✅ 删除过时的日志分析文档
- ✅ 简化项目结构
- ✅ 整合配置脚本到 `scripts/` 目录

---

## v4.0.0 Modified (2026-01-10)

### 🎉 重大更新
- ✅ 集成 BettaFish 多智能体舆情分析系统
- ✅ 支持云端数据库和本地数据库
- ✅ 新增数据库模式切换功能
- ✅ 新增自动配置脚本

### 🚀 新增功能
- 📊 BettaFish 深度舆情分析
- 📊 情感分析
- 📊 媒体分析
- 📊 报告生成
- 🔍 网络搜索集成（Tavily/Bocha）
- 🔄 数据库模式切换（Cloud/Local/Hybrid）

### ⚙️ 配置优化
- ✅ 优化 BettaFish 配置流程
- ✅ 自动化配置脚本
- ✅ 数据库初始化脚本

---

## v3.5.0 Modified (2025-12-20)

### 🚀 新增功能
- 🎤 唱歌功能（通过 TTS 情感朗读）
- 🎤 切换唱歌模式脚本
- 📝 唱歌 Prompt 优化
- 📝 唱歌文档完善

### 🔧 改进
- ✅ 优化 Prompt 提示
- ✅ 添加情感朗读模式
- ✅ 改进歌词创作能力

---

## v3.0.0 Modified (2025-12-10)

### 🎉 重大更新
- ✅ 完全重构 QQ/WeChat 集成
- ✅ 支持长文本自动分段
- ✅ 支持长语音自动分段
- ✅ 新增智能语意分析器

### 🚀 新增功能
- 📝 长文本自动分段（500 字符/段）
- 🎙️ 长语音自动分段（200 字符/段）
- 🧠 智能语义分割
- 🔀 回复模式切换（文本/语音/图文）
- 👥 群聊回复控制（白名单/黑名单/@触发/关键词触发）

### 🔧 Bug 修复
- ✅ 修复 PC 端重复输出
- ✅ 修复 QQ 端图片识别不按人设
- ✅ 修复消息格式不响应命令
- ✅ 修复长文本输出不完整
- ✅ 修复长文本不分多次发送

### ⚡ 性能优化
- 📊 MCP 回调超时：5s → 30s
- 📊 任务去重缓存机制
- 📊 优化回调重试机制

---

## v2.5.0 Modified (2025-11-15)

### 🚀 新增功能
- 📱 移动端访问支持
- 🌐 PWA 支持（可添加到主屏幕）
- 📊 响应式设计

### 🔧 改进
- ✅ 优化移动端界面
- ✅ 改进触摸交互
- ✅ 优化网络连接

---

## v2.0.0 Modified (2025-10-20)

### 🎉 重大更新
- ✅ 集成 GRAG 记忆系统
- ✅ 支持 Neo4j 图数据库
- ✅ 跨场景记忆（群聊/私聊统一）

### 🚀 新增功能
- 🧠 GRAG 知识图谱
- 💾 Neo4j 集成
- 📊 记忆可视化
- 🔍 智能检索

---

## v1.5.0 Modified (2025-09-10)

### 🚀 新增功能
- 🤖 MCP 工具调用支持
- 🔧 48+ 工具集成
- 🔍 网络搜索
- 🎨 AI 绘图
- 🌤️ 天气查询
- 🎵 音乐搜索

### 🔧 改进
- ✅ 优化工具调用机制
- ✅ 改进错误处理
- ✅ 添加工具帮助系统

---

## v1.0.0 Modified (2025-08-01)

### 🎉 初始发布
- ✅ 基于 NagaAgent 的魔改版本
- ✅ PyQt5 图形界面
- ✅ Live2D 虚拟形象
- 🤖 QQ 机器人集成（NapCat）
- 🤖 微信机器人集成
- 🎤 TTS 语音合成（GPT-SoVITS/Edge-TTS/VITS）
- 🎨 AI 绘图（云端/本地）
- 📱 多端支持（PC/网页/移动）

---

## 📊 版本说明

### 版本号格式
- `vX.Y.Z Modified`
  - `X` - 主版本号（重大更新）
  - `Y` - 次版本号（新功能）
  - `Z` - 修订号（Bug 修复）

### 更新类型
- 🎉 重大更新 - 重大功能或架构变更
- 🚀 新增功能 - 新增功能或特性
- 🔧 改进 - 优化或改进现有功能
- 🐛 Bug 修复 - 修复 Bug
- ⚡ 性能优化 - 性能改进
- 📝 文档更新 - 文档改进或新增

---

## 🔜 计划中的功能

- [ ] 更多 TTS 引擎支持
- [ ] 更多 LLM 提供商支持
- [ ] 语音识别（STT）
- [ ] 视频通话
- [ ] 更多工具集成
- [ ] 插件系统
- [ ] 多语言支持
- [ ] 主题定制

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

---

## 📮 更新渠道

- GitHub Releases
- 文档中心
- 社区公告

---

**感谢使用 NagaAgent！** 🎉
