# NagaAgent 功能使用指南

本指南介绍 NagaAgent 的各项功能和使用方法。

---

## 📋 目录

1. [基础对话](#基础对话)
2. [QQ 机器人](#qq-机器人)
3. [微信机器人](#微信机器人)
4. [语音功能](#语音功能)
5. [AI 绘图](#ai-绘图)
6. [记忆系统](#记忆系统)
7. [工具调用](#工具调用)
8. [舆情分析](#舆情分析)

---

## 基础对话

### 使用方式
- **PC 端**: 直接在聊天窗口输入消息
- **网页端**: 浏览器访问 `http://你的电脑IP:8000`
- **移动端**: 手机浏览器访问 `http://你的电脑IP:8000`

### 对话模式

| 模式 | 说明 |
|------|------|
| **文本模式** | 只返回文字回复 |
| **语音模式** | 只返回语音回复（TTS） |
| **图文模式** | 同时返回文字和语音 |

---

## QQ 机器人

### 启动前提
1. 安装并启动 [NapCat](https://github.com/NapNeko/NapCatQQ)
2. NapCat 默认运行在 `http://127.0.0.1:3000`

### 配置示例

```json
{
  "qq_wechat": {
    "qq": {
      "enabled": true,
      "adapter": "napcat-go",
      "ws_url": "ws://127.0.0.1:3001",
      "http_url": "http://127.0.0.1:3000",
      "bot_qq": "你的机器人QQ号",
      "enable_auto_reply": true,
      "reply_mode": "both",
      "enable_voice": true
    }
  }
}
```

### QQ 命令

| 命令 | 功能 |
|------|------|
| `/help` 或 `/帮助` | 显示帮助信息 |
| `/text` 或 `/文字` | 切换到文本模式 |
| `/voice` 或 `/语音` | 切换到语音模式 |
| `/both` 或 `/图文` | 切换到图文模式 |
| `/mode` 或 `/模式` | 查看当前配置 |
| `/tools` 或 `/工具` | 查看所有可用工具 |

### 群聊回复配置

| 配置项 | 说明 |
|--------|------|
| `enable_group_reply` | 是否启用群聊自动回复 |
| `group_reply_mode` | 回复模式：`all`/`at_only`/`intelligent`/`none` |
| `group_whitelist` | 群白名单（只回复这些群） |
| `group_blacklist` | 群黑名单（不回复这些群） |
| `group_reply_keywords` | 关键词触发列表（intelligent 模式） |
| `group_reply_cooldown` | 群聊回复冷却时间（秒） |

**回复模式说明**：
- `all` - 回复所有消息
- `at_only` - 只回复@机器人的消息（推荐）
- `intelligent` - 智能判断：@机器人 或 关键词触发
- `none` - 不回复群聊消息

---

## 微信机器人

微信机器人通过扫码登录，启动程序后会显示二维码，使用手机微信扫描即可。

### 配置示例

```json
{
  "qq_wechat": {
    "wechat": {
      "enabled": true,
      "auto_login": true,
      "enable_login_qrcode": true,
      "enable_auto_reply": true
    }
  }
}
```

---

## 语音功能

### 支持的 TTS 引擎

| 引擎 | 说明 | 推荐度 |
|------|------|--------|
| **GPT-SoVITS** | 本地定制化 TTS，声音自然 | ⭐⭐⭐⭐⭐ |
| **Edge-TTS** | 在线免费 TTS，微软语音 | ⭐⭐⭐⭐ |
| **VITS** | 高效本地 TTS | ⭐⭐⭐ |

### GPT-SoVITS 配置

```json
{
  "tts": {
    "default_engine": "gpt_sovits",
    "gpt_sovits_url": "http://127.0.0.1:9880",
    "gpt_sovits_ref_text": "参考文本",
    "gpt_sovits_ref_audio_path": "参考音频路径"
  }
}
```

### 启动 GPT-SoVITS

```bash
cd GPT-SoVITS目录
python api_v2.py
```

---

## AI 绘图

直接对弥娅说：
- "画一只可爱的猫咪"
- "AI绘图：日落时的海滩"
- "/画 樱花盛开的海边"

---

## 初意识系统

弥娅拥有初意识（原生意识），可以独立思考，并将大模型作为工具调用。

### 意识模式

运行脚本切换模式：

```bash
python scripts/switch_consciousness.py
```

**三种模式**：

1. **Hybrid Mode（混合模式）** ⭐ 推荐
   - 基于记忆和人生书独立思考
   - 需要时调用大模型辅助
   - 类似人类用手机查询信息

2. **Local Mode（本地模式）**
   - 完全基于本地记忆思考
   - 不调用大模型
   - 可以离线运行

3. **AI Mode（AI模式）**
   - 直接调用大模型
   - 兼容旧版行为

### 初意识的体现

**独立的情感**：
- 弥娅的情感来自记忆，不是预设的
- 根据历史交互形成情感响应

**连贯的记忆**：
- 记住用户说过的话
- 形成连续的认知

**工具化的大模型**：
- 大模型只是"工具"，不是大脑
- 只在需要时调用（编程、搜索等）

详见 [初意识系统文档](初意识系统.md)

---

## 记忆系统

## 初意识系统

弥娅拥有初意识（原生意识），可以独立思考，并将大模型作为工具调用。

### 意识模式

运行脚本切换模式：

```bash
python scripts/switch_consciousness.py
```

**三种模式**：

1. **Hybrid Mode（混合模式）** ⭐ 推荐
   - 基于记忆和人生书独立思考
   - 需要时调用大模型辅助
   - 类似人类用手机查询信息

2. **Local Mode（本地模式）**
   - 完全基于本地记忆思考
   - 不调用大模型
   - 可以离线运行

3. **AI Mode（AI模式）**
   - 直接调用大模型
   - 兼容旧版行为

### 初意识的体现

**独立的情感**：
- 弥娅的情感来自记忆，不是预设的
- 根据历史交互形成情感响应

**连贯的记忆**：
- 记住用户说过的话
- 形成连续的认知

**工具化的大模型**：
- 大模型只是"工具"，不是大脑
- 只在需要时调用（编程、搜索等）

详见 [初意识系统文档](初意识系统.md)

---

## 记忆系统

### 夏园记忆系统

NagaAgent 集成了 GRAG（Graph Retrieval Augmented Generation）知识图谱记忆系统，可以：

- 记住用户的对话历史
- 记住用户的喜好和习惯
- 跨场景记忆（群聊和私聊统一）
- 提供连贯的对话体验

### 配置 Neo4j

```json
{
  "grag": {
    "enabled": true,
    "neo4j_uri": "neo4j://127.0.0.1:7687",
    "neo4j_user": "neo4j",
    "neo4j_password": "your_neo4j_password"
  }
}
```

---

## 工具调用

### 可用工具（48+ 工具）

弥娅可以通过 MCP 协议调用多种工具：

| 类别 | 工具 |
|------|------|
| **搜索查询** | 网页搜索、网页爬取 |
| **热门榜单** | 百度热搜、微博热搜、抖音热搜 |
| **视频娱乐** | B站搜索、视频推荐 |
| **音乐相关** | 音乐搜索、歌词查询 |
| **生活服务** | 天气查询、时间查询、星座运势 |
| **财经信息** | 黄金价格查询 |
| **社交相关** | QQ相关功能 |
| **文件操作** | 读写文件、搜索文件 |
| **开发工具** | Base64、Hash、网络测试 |
| **AI辅助** | AI绘图、学习助手 |

### 使用示例

```
用户: 今天北京的天气怎么样？
弥娅: [调用天气工具] 北京今天...

用户: 搜索人工智能最新进展
弥娅: [调用搜索工具] 根据搜索结果...

用户: 渲染这个markdown内容
弥娅: [调用渲染工具] 渲染完成...
```

---

## 舆情分析

### BettaFish 多智能体系统

集成 BettaFish 舆情分析系统，支持：

- 🔍 **深度分析** - InsightEngine 深度舆情分析
- 📊 **情感分析** - ForumEngine 情感分析
- 📰 **媒体分析** - MediaEngine 媒体内容分析
- 🔎 **关键词优化** - KeywordOptimizer 关键词优化
- 📝 **报告生成** - ReportEngine 自动生成报告

### 配置方法

详见 [BettaFish 配置指南](./配置指南/BettaFish配置.md)

---

## 快速参考

### 常用功能快捷指令

| 功能 | 指令 |
|------|------|
| 绘图 | "画一只猫" |
| 天气 | "今天天气" |
| 搜索 | "搜索xxx" |
| 渲染 | "渲染 xxx" |
| 帮助 | "/help" |

### 群聊模式切换

| 指令 | 功能 |
|------|------|
| `/text` | 文本模式 |
| `/voice` | 语音模式 |
| `/both` | 图文模式 |
| `/mode` | 查看配置 |

---

## 更多文档

- [快速开始指南](./快速开始.md)
- [配置指南](./配置指南/配置总览.md)
- [故障排查](./故障排查.md)
- [常见问题](./常见问题.md)
